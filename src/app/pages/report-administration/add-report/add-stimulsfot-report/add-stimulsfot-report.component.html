<div class="flex align-items-center gap-3 border-bottom-1 border-300  pb-3 w-full mb-3">
    <!--<button pButton icon="pi pi-arrow-left" class="p-button-text"www.>Volver</button>-->
    <div class="flex align-items-center gap-2">
    <div class="w-3rem h-3rem border-round bg-blue-200 border-1 border-blue-800 flex align-items-center justify-content-center">
        <i class="pi pi-file text-blue-800 text-xl"></i>
    </div>
    <div>
        <h3 class="m-0 text-xl font-bold text-gray-800" *ngIf="!isEdit">Nuevo Reporte Stimulsoft</h3>
        <h3 class="m-0 text-xl font-bold text-gray-800" *ngIf="isEdit">Editar Reporte Stimulsoft</h3>
        <p class="m-0 text-sm text-color-secondary">Configura tu reporte personalizado</p>
    </div>
    </div>
</div>


    <div class="flex flex-column gap-1 mb-3">
        <label for="nombre">Nombre del Reporte *</label>
        <input id="nombre" pInputText  placeholder="Ej: Reporte de Inventario" [(ngModel)]="nuevoReporte.nombre" [ngClass]="validations.name.error && !nuevoReporte.nombre ? 'ng-invalid ng-dirty' : ''"/>
        <p-message *ngIf = "validations.name.error && !nuevoReporte.nombre" severity="error" variant="simple" size="small">{{validations.name.message}}</p-message>
    </div>
    <div class="flex flex-column gap-1 mb-3">
        <label for="descripcion">Descripción *</label>
        <textarea id="descripcion" pTextarea  rows="3" placeholder="Descripción detallada del reporte..." [(ngModel)]="nuevoReporte.descripcion" [ngClass]="validations.description.error && !nuevoReporte.descripcion ? 'ng-invalid ng-dirty' : ''"></textarea>
        <p-message *ngIf = "validations.description.error && !nuevoReporte.descripcion" severity="error" variant="simple" size="small">{{validations.description.message}}</p-message>
    </div>
<div class="grid mb-3">
    <div class="col-6" *ngIf="clasificacion">
        <app-category-list [hijos]="clasificacion" [inputSeleccionados]="inputReporteAdicionales" [showError] = "validations.category" (emitirListaCategorias)="getListaCategorias($event)" ></app-category-list>
    </div>
    <div class="col-6">
        <app-sp-list [idKatios]="idKatios" [inputStored]="nuevoReporte.storedProcedure" [showError] = "validations.storeProcedure" (storedSeleccionado)="storedChange($event)"></app-sp-list> 
    </div>               
</div>

<div class="flex flex-column gap-1">
    <label for="reportFile">Archivo de Reporte (.mrt) *</label>
    <p-fileupload class="w-full fileupload-custom" mode="basic" name="demo[]" chooseIcon="pi pi-upload" url="https://www.primefaces.org/cdn/api/upload.php" accept=".mrt" maxFileSize="1000000" (onUpload)="onUpload($event)" [auto]="true" chooseLabel="Browse" />
    <div *ngIf="fileMrt" class="format mt-2">
    <div class="grid formgrid grid-nogutter p-fluid text-sm">
      <div class="field col-12 md:col-6">
        <label class="font-semibold text-primary text-base">Nombre:</label>
        <p class="text-color-secondary text-truncate">{{ fileMrt.name }}</p>
      </div>

      <div class="field col-12 md:col-6">
        <label class="font-semibold text-primary text-base">Tamaño:</label>
        <p class="text-color-secondary">{{ fileMrt.size }}</p>
      </div>
      <div class="field col-12 md:col-6">
        <label class="font-semibold text-primary text-base">Modificado:</label>
        <p class="text-color-secondary">{{ lastModified }}</p>
      </div>

      <div class="field col-12 md:col-6">
        <label class="font-semibold text-primary text-base">Tipo:</label>
        <p class="text-color-secondary">Stimulsoft Report</p>
      </div>
    </div>

    <div *ngIf="jsonMrt" class="mt-3">
      <label class="font-semibold text-primary text-base">Contenido (primeros 500 caracteres):</label>
      <div class="bg-white border-round border-1 border-blue-200 p-3 text-xs overflow-y-auto" style="max-height: 8rem;">
        {{ jsonMrt.slice(0, 500) }}...
      </div>
    </div>

    <div class="flex align-items-center gap-2 pt-3">
        <p-chip label="Archivo válido" icon="pi pi-check-circle" 
        [style]="{
        'background-color': '#d1fae5',
        'color': '#065f46',
        'border': '1px solid #34d399',
        
    }"/>
    </div>
</div>
    <p-message *ngIf = "validations.file.error && !fileMrt" severity="error" variant="simple" size="small">{{validations.file.message}}</p-message>
</div>  

    <!-- Botón Guardar -->
<div class="flex justify-content-end mt-4">
    <button
        pButton
        *ngIf="!isEdit"
        label="Crear Reporte Stimulsoft"
        class="p-button bg-blue-200 border-1 border-blue-800 text-blue-800"
        icon="pi pi-save"
        (click)="crearReporteClick()"
        [disabled] = "isEdit"
    ></button>
    <button
        pButton
        *ngIf="isEdit"
        label="Editar Reporte Stimulsoft"
        class="p-button bg-blue-200 border-1 border-blue-800 text-blue-800"
        icon="pi pi-pen-to-square"
        (click)="editarReporteClick()"
        [disabled] = "!isEdit"
    ></button>
</div> 